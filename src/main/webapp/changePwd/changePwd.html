<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
<head>
  <meta http-equiv="content-type" content="application/xhtml+xml; charset=UTF-8" />
  <title>Change Password Menu</title>
</head>
<body>
<h1>Change Password Menu</h1>

<form id="change-form">
  <label for="password">Password:</label>
  <input type="password" id="password" name="password">
  <label for="passwordV">Verify Password:</label>
  <input type="password" id="passwordV" name="passwordV">
  <label for="newPassword">New Password:</label>
  <input type="password" id="newPassword" name="newPassword">
  <button type="submit">Change!</button>

</form>

<script>
  const form = document.getElementById("change-form");

  form.addEventListener("submit", (event) => {
    event.preventDefault();
    const username = JSON.parse(sessionStorage.getItem("token")).username;
    const expiration = JSON.parse(sessionStorage.getItem("token")).expirationDate;
    const oldPassword = form.elements.password.value;
    const passwordV = form.elements.passwordV.value;
    const newPassword = form.elements.newPassword.value;

    const data = {username, expiration, newPassword, oldPassword, passwordV};

    fetch("/rest/changepwd/", {
      method: "PUT",
      headers: {
        "Content-Type": "application/json"
      },
      body: JSON.stringify(data)
    })
            .then(response => {
              if (response.status === 200) {
                  window.location.href = "/changePwd/200.html";
              } else if (response.status === 400) {
                window.location.href = "/changePwd/400.html";
              }else if (response.status === 403){
                window.location.href = "/changePwd/403.html";
              }else if (response.status === 500){
                window.location.href = "/changePwd/500.html";
              }
            })

  })


</script>

</body>
</html>