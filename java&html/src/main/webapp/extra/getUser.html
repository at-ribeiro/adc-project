<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
<head>
  <meta http-equiv="content-type" content="application/xhtml+xml; charset=UTF-8" />
  <title>Get User</title>
</head>

<body>

<h1>Get User</h1>

<form id="update-form">
  <label for="username">User:</label>
  <input type="text" id="username" name="username">

  <button type="submit">GET</button>

  <ul id="user-info"></ul>

</form>

<script>
  const form = document.getElementById("update-form");
  const userInfo = document.getElementById("user-info")

  form.addEventListener("submit", (event) => {
    event.preventDefault();
    const username = form.elements.username.value;
    const role = JSON.parse(sessionStorage.getItem("token")).role;
    const tUser = JSON.parse(sessionStorage.getItem("token")).username;
    const expiration = JSON.parse(sessionStorage.getItem("token")).expirationDate;


    fetch(`/rest/get/?username=${username}&tUser=${tUser}&role=${role}&expiration=${expiration}` , {
      method: "GET",
      headers: {
        "Content-Type": "application/json"
      },
    })
          .then(response => {
            if (response.status === 200) {
              response.json().then(user => {
                userInfo.innerHTML = `  <p>username: ${user.username}</p>
                                        <p>fullname: ${user.fullname}</p>
                                        <p>email: ${user.email}</p>
                                        <p>privacy: ${user.privacy}</p>
                                        <p>homephone: ${user.homephone}</p>
                                        <p>mobilephone: ${user.mobilephone}</p>
                                        <p>occupation: ${user.occupation}</p>
                                        <p>address: ${user.address}</p>
                                        <p>nif: ${user.nif}</p>
                                        <p>role: ${user.role}</p>
                                        <p>state: ${user.state}</p>`;
              })
            }
            else if(response.status === 401){
              window.location.href = "/extra/401.html";
            }else if(response.status === 403){
              userInfo.innerHTML = `<p>Your role does not give your permission to reveal this User.</p>`;
            }else if(response.status === 404){
              userInfo.innerHTML = `<p>User not found.</p>`;
            }else if(response.status === 500){
              userInfo.innerHTML = `<p>Internal Server Error. Please try again later</p>`;
            }
          })
  })
</script>
</body>
